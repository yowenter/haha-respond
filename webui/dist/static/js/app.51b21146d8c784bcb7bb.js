webpackJsonp([1],{0:function(t,e){},1:function(t,e){},"3fFk":function(t,e){},"6IJX":function(t,e){},CMvz:function(t,e){},EXjv:function(t,e,n){t.exports=n.p+"static/img/logo-green.22f6039.png"},JHSe:function(t,e){},"Lm+9":function(t,e){},NHnr:function(t,e,n){"use strict";function s(t){n("JHSe")}function o(t){n("6IJX")}function a(t){n("XVgI")}function i(t){n("Lm+9")}function r(t){n("uko2")}function c(t){n("i6jY")}function l(t){n("ubtR")}function u(t){n("3fFk")}function d(t){n("Nj8z")}Object.defineProperty(e,"__esModule",{value:!0});var m=(n("u7Vc"),n("7+uW")),h=n("ymRw"),f=n.n(h),v=(n("CMvz"),n("mtWM")),p=n.n(v),_="http://haha-static.daocom.io";Object({NODE_ENV:"production"}).API_URL&&(_=Object({NODE_ENV:"production"}).API_URL,"/"===Object({NODE_ENV:"production"}).API_URL&&(_=".")),m.default.prototype.API_URL=_;var g=p.a.create({baseURL:_,headers:{"Content-Type":"application/json"}}),b=g,x=_,w=new m.default,C=function(t){return b.post("/comments",{event:"comment",data:t}).then(function(t){return t.data})},k=function(t,e){return b.post("/api/user",{username:t,email:e}).then(function(t){return t.data})},y=function(t,e){return b.post("/api/join",{email:t,room:e}).then(function(t){return t.data})},R=function(t){var e=t.email,n=t.examId,s=t.choiceId,o=t.questionId,a=t.score;return b.post("/api/votes",{email:e,exam_id:n,choice_id:s,question_id:o,score:a}).then(function(t){return t.data})},I=function(){var t=localStorage.getItem("room_id");return b.get("/api/report",{params:{room:t}}).then(function(t){return t.data})},D={comment:C,join:y,rank:I,register:k,vote:R},S={name:"Popup",data:function(){return{sec:10,show:!1,data:null,startTime:null,endTime:null,choice:null,score:0}},created:function(){},mounted:function(){var t=this;w.$on("data",function(e){t.data=e,t.show=!0,t.countdown(),t.startTime=(new Date).getTime(),t.rightId=e.choices.find(function(t){return t.is_right}).choice_id})},computed:{isRight:function(){return this.choice&&this.rightId&&this.rightId===this.choice}},methods:{countdown:function(){var t=this;this.sec=10;var e=setInterval(function(){t.countdownAnimation(t.sec),0!==t.sec?t.sec=t.sec-1:(clearInterval(e),setTimeout(function(){t.score&&Object(h.Toast)("恭喜答对了，加 "+t.score+" 分"),t.hidePopup()},2e3))},1e3)},countdownAnimation:function(t){var e=document.querySelectorAll("circle")[1],n=(11-t)/10,s=2*Math.PI*35;n>.6&&e.setAttribute("stroke","rgb(255,135,135)"),e.setAttribute("stroke-dasharray",s*n+" "+s*(1-n))},choose:function(t){var e=this;if(!this.choice&&this.sec){this.choice=t.choice_id,this.endTime=(new Date).getTime();var n=t.is_last_question?200:100,s=(this.endTime-this.startTime)*n/1e4;s=t.is_right?s.toFixed():0,D.vote({email:localStorage.getItem("email"),examId:localStorage.getItem("exam_id"),choiceId:t.choice_id,questionId:this.data.question_id,score:s}).then(function(t){e.score=s})}},hidePopup:function(){document.querySelectorAll("circle")[1].setAttribute("stroke","rgb(77,171,247)"),this.show=!1,this.startTime=null,this.endTime=null,this.choice=null,this.score=0,w.$emit("user_vote")}}},$=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("van-popup",{attrs:{overlay:!0,"close-on-click-overlay":!1},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("div",{staticClass:"countdown"},[n("svg",{attrs:{width:"80",height:"80",viewbox:"0 0 80 80"}},[n("circle",{attrs:{cx:"40",cy:"40",r:"35","stroke-width":"10",stroke:"#fff",fill:"none"}}),t._v(" "),n("circle",{attrs:{cx:"40",cy:"40",r:"35","stroke-width":"10",stroke:"rgb(77,171,247)",fill:"none",transform:"matrix(0,-1,1,0,0,80)","stroke-dasharray":"0 300","stroke-linecap":"round"}})]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.sec,expression:"sec"}],staticClass:"sec"},[t._v(t._s(t.sec))]),t._v(" "),n("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.sec&&!t.isRight,expression:"!sec && !isRight"}],staticClass:"sec",staticStyle:{color:"rgb(252,196,25)"},attrs:{name:"fail"}}),t._v(" "),n("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.sec&&t.isRight,expression:"!sec && isRight"}],staticClass:"sec",staticStyle:{color:"rgb(81,207,102)"},attrs:{name:"success"}})],1),t._v(" "),t.data?n("div",{staticClass:"question"},[n("div",{staticClass:"title"},[t._v(t._s(t.data.question_text))]),t._v(" "),t._l(t.data.choices,function(e){return n("div",{staticClass:"option",class:{choice:t.choice===e.choice_id,"show-answer":!t.sec,bingo:e.is_right,error:t.choice===e.choice_id&&!e.is_right},on:{click:function(n){t.choose(e)}}},[t._v("\n      "+t._s(e.choice_text)+"\n    ")])})],2):t._e()])},E=[],N={render:$,staticRenderFns:E},z=N,A=n("VU/8"),j=s,T=A(S,z,!1,j,"data-v-377b436a",null),V=T.exports,F={name:"App",components:{popup:V}},M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view"),t._v(" "),n("popup")],1)},B=[],U={render:M,staticRenderFns:B},q=U,O=n("VU/8"),L=o,P=O(F,q,!1,L,null,null),X=P.exports,H=n("/ocq"),J={name:"Index",data:function(){return{}},mounted:function(){localStorage.getItem("email")?this.$router.push({name:"Board"}):this.$router.push({name:"Register"})}},K=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-loading",{attrs:{type:"gradient-circle",color:"black"}})],1)},G=[],W={render:K,staticRenderFns:G},Y=W,Q=n("VU/8"),Z=a,tt=Q(J,Y,!1,Z,null,null),et=tt.exports,nt={name:"Register",data:function(){return{username:"",email:"",password:"afsjfk2123",loading:!1}},methods:{checkValid:function(){var t=this.username,e=this.email,n=new RegExp(/(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/),s=new RegExp(/@daocloud\.io/);return t&&e?n.test(e)?!!s.test(e)||(this.showDialog("必须为 daocloud.io 域名的邮箱"),!1):(this.showDialog("邮箱格式错误"),!1):(this.showDialog("昵称及邮箱均不能为空"),!1)},showDialog:function(t){h.Dialog.alert({message:t}).then(function(){})},submit:function(){var t=this;this.checkValid()&&(this.loading=!0,D.register(this.username,this.email).then(function(){t.loading=!1,localStorage.setItem("email",t.email),localStorage.setItem("username",t.username),t.$router.push({name:"Code"})},function(){t.loading=!1,t.showDialog("注册失败，请重试")}))}}},st=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"register"},[s("img",{attrs:{src:n("EXjv")}}),t._v(" "),s("p",{staticClass:"top-text"},[t._v("请输入昵称及公司邮箱进行注册")]),t._v(" "),s("van-cell-group",[s("van-field",{attrs:{label:"名称",icon:"clear",placeholder:"请输入用户名",required:""},on:{"click-icon":function(e){t.username=""}},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),t._v(" "),s("van-field",{attrs:{label:"公司邮箱",icon:"clear",placeholder:"请输入公司邮箱",required:""},on:{"click-icon":function(e){t.email=""}},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}})],1),t._v(" "),s("van-button",{staticClass:"sub-button",attrs:{size:"large",type:"primary",loading:t.loading,disabled:t.loading},on:{click:t.submit}},[t._v("提交")])],1)},ot=[],at={render:st,staticRenderFns:ot},it=at,rt=n("VU/8"),ct=i,lt=rt(nt,it,!1,ct,null,null),ut=lt.exports,dt=n("DmT9"),mt=n.n(dt),ht="."===x?"":x,ft=function(){var t=localStorage.getItem("room_id"),e=void 0;e&&e.disconnect(),e=mt()(""+ht,{path:"/stream/socket.io"}),e.on("connect",function(){e.emit("enter_room",t)}),e.on("question_update",function(t){w.$emit("data",t)}),e.on("disconnect",function(){});var n=void 0;n&&n.disconnect(),n=mt()(""+ht,{path:"/danmus/socket.io"}),n.on("connect",function(){n.emit("enter_room","88888")}),n.on("comment",function(t){w.$emit("comment",t)}),n.on("disconnect",function(){})},vt=n("Dd8w"),pt=n.n(vt),_t=n("M4fF"),gt=n("woOf"),bt=n.n(gt),xt={name:"TextAvatar",props:["data"],data:function(){return{currentData:{text:"匿",color:"#ffffff",bg:"#3890ff",boxShadow:"rgb(180,180,180)",border:"rgb(180,180,180)",type:"normal"}}},created:function(){this.setCurrentData(this.data)},watch:{data:function(t){this.setCurrentData(t)}},computed:{fontSize:function(){var t=this.currentData.text.length;return 1===t||0===t?35:100/t}},methods:{setCurrentData:function(t){t&&(this.currentData=bt()({},this.currentData,t))}}},wt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[n("defs",[n("filter",{attrs:{id:"bs"+t.currentData.type,x:"-1",y:"-1",width:"300%",height:"300%"}},[n("feGaussianBlur",{attrs:{in:"SourceAlpha",stdDeviation:"8"}}),t._v(" "),n("feOffset",{attrs:{result:"offsetblur",dx:"0",dy:"0"}}),t._v(" "),n("feFlood",{attrs:{"flood-color":t.currentData.boxShadow}}),t._v(" "),n("feComposite",{attrs:{in2:"offsetblur",operator:"in"}}),t._v(" "),n("feMerge",[n("feMergeNode"),t._v(" "),n("feMergeNode",{attrs:{in:"SourceGraphic"}})],1)],1),t._v(" "),n("filter",{attrs:{id:"bd"+t.currentData.type,x:"-1",y:"-1",width:"300%",height:"300%"}},[n("feGaussianBlur",{attrs:{in:"SourceAlpha",stdDeviation:"1"}}),t._v(" "),n("feOffset",{attrs:{result:"offsetblur",dx:"0",dy:"0"}}),t._v(" "),n("feFlood",{attrs:{"flood-color":t.currentData.border}}),t._v(" "),n("feComposite",{attrs:{in2:"offsetblur",operator:"in"}}),t._v(" "),n("feMerge",[n("feMergeNode"),t._v(" "),n("feMergeNode",{attrs:{in:"SourceGraphic"}})],1)],1)]),t._v(" "),n("rect",{style:{fill:t.currentData.bg},attrs:{x:"20",y:"20",rx:"10",ry:"10",width:"60",height:"60",stroke:"white","stroke-width":"2.5",transform:"rotate(45, 50 50)",filter:"url(#bd"+t.currentData.type+")"}}),t._v(" "),n("rect",{style:{fill:t.currentData.bg},attrs:{x:"20",y:"20",rx:"10",ry:"10",width:"60",height:"60",stroke:"white","stroke-width":"2.5",transform:"rotate(45, 50 50)",filter:"url(#bs"+t.currentData.type+")"}}),t._v(" "),n("text",{staticStyle:{"font-weight":"400"},attrs:{"text-anchor":"middle",y:"50%",x:"50%",dy:"0.35em",fill:t.currentData.color,"font-size":t.fontSize}},[t._v(t._s(t.currentData.text))])])},Ct=[],kt={render:wt,staticRenderFns:Ct},yt=kt,Rt=n("VU/8"),It=Rt(xt,yt,!1,null,null,null),Dt=It.exports,St={name:"Rank",components:{TextAvatar:Dt},data:function(){return{colors:["#008bb9","#05A4D8","#1ED5F1","#0B77CA"],colors2:["#da381b","#e86f3c","#f3b00f"],topColors:["rgb(251, 151, 133)","rgb(226, 147, 114)","rgb(234, 194, 98)"],topNameColors:["rgb(218, 56, 27)","rgb(232, 111, 60)","rgb(243, 176, 15)"],randomColorNumber:4,ranks:[]}},created:function(){var t=this;this.getRanks(),w.$on("user_vote",function(){t.getRanks()})},computed:{sortedRanks:function(){return Object(_t.clone)(this.ranks).sort(function(t,e){return e.total_score-t.total_score})},topRanks:function(){return this.sortedRanks.slice(0,3)},otherRanks:function(){return this.sortedRanks.slice(3)}},methods:{getRanks:function(){var t=this;D.rank().then(function(e){t.ranks=e})},getIcon:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=n?this.colors2:this.colors,a=n?3:this.randomColorNumber;return pt()({text:t.slice(0,1),color:"#ffffff",bg:o[e%a]},s)}}},$t=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"rank-list"},[n("h1",[t._v("排行榜 | Ranking")]),t._v(" "),n("div",{staticClass:"rank-top"},t._l(t.topRanks,function(e,s){return n("div",{staticClass:"top-item"},[n("text-avatar",{staticClass:"icon",attrs:{data:t.getIcon(e.username,s,!0,{border:t.topColors[s],boxShadow:t.topColors[s],type:s})}}),t._v(" "),n("div",{staticClass:"username",style:"color: "+t.topNameColors[s]+";"},[t._v("\n        "+t._s(s+1+". "+e.username)),n("br"),t._v(" "),n("span",{staticStyle:{"font-size":"25px"}},[t._v("\n          "+t._s(e.total_score)+"\n        ")])])],1)})),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"rank-container"},t._l(t.otherRanks,function(e,s){return n("div",{staticClass:"rank"},[n("div",{staticClass:"rank-left"},[n("text-avatar",{staticClass:"icon",attrs:{data:t.getIcon(e.username,s)}})],1),t._v(" "),n("div",{staticClass:"rank-right"},[n("div",{staticClass:"name"},[t._v(t._s(s+4+". "+e.username))]),t._v(" "),n("div",{staticClass:"score"},[t._v(t._s(e.total_score))])])])}))])},Et=[],Nt={render:$t,staticRenderFns:Et},zt=Nt,At=n("VU/8"),jt=r,Tt=At(St,zt,!1,jt,null,null),Vt=Tt.exports,Ft={name:"CommentBox",props:{show:{default:!1}},data:function(){return{visible:!1,message:"",error:""}},watch:{show:function(t){this.visible=t},visible:function(t){!1===t&&this.$emit("closed")}},methods:{checkMessage:function(){return this.message?(this.error="",!0):(this.error="不能提交空值",!1)},submitMessage:function(){var t=this,e=this.checkMessage(),n=this.message,s=localStorage.getItem("username"),o=localStorage.getItem("email"),a=+new Date;e&&D.comment({message:n,user:s,email:o,time:a}).then(function(){t.message="",t.$emit("closed")},function(){t.error="提交失败"})}}},Mt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-box"},[n("van-popup",{staticClass:"input-field",attrs:{position:"top",overlay:!0},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[n("van-field",{attrs:{type:"textarea",placeholder:"请输入评论",rows:"1",autosize:""},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),t._v(" "),t.error?n("p",{staticClass:"error"},[t._v(t._s(t.error))]):t._e(),t._v(" "),n("van-button",{staticClass:"sub-button",attrs:{size:"small",type:"primary"},on:{click:t.submitMessage}},[t._v("提交")])],1)],1)},Bt=[],Ut={render:Mt,staticRenderFns:Bt},qt=Ut,Ot=n("VU/8"),Lt=c,Pt=Ot(Ft,qt,!1,Lt,"data-v-27773d9b",null),Xt=Pt.exports,Ht={name:"Comment",components:{CommentBox:Xt},data:function(){return{messages:[],show:!1,roby:"roby.chen@daocloud.io"}},mounted:function(){var t=this;w.$on("comment",function(e){t.messages.push(e),t.judgeLength(),t.$nextTick(function(){var t=document.getElementsByClassName("comment-list")[0];t.scrollTop=t.scrollHeight})})},methods:{judgeLength:function(){var t=this.messages.length;t>100&&(this.messages=this.messages.slice(t-100,t))},showCommentBox:function(){this.show=!0},closeCommentBox:function(){this.show=!1}}},Jt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comments-wrapper"},[n("div",{staticClass:"comments"},[t._m(0),t._v(" "),n("ul",{staticClass:"comment-list"},t._l(t.messages,function(e){return n("li",{key:e.time,staticClass:"comment"},[e.email!==t.roby?[n("span",{staticClass:"name"},[t._v(t._s(e.user))]),n("span",{staticClass:"message"},[t._v(t._s(e.message))])]:[n("span",{staticClass:"tag roby"},[t._v("老板")]),n("span",{staticClass:"name roby"},[t._v(t._s(e.user))]),n("span",{staticClass:"message roby"},[t._v(t._s(e.message))])]],2)}))]),t._v(" "),n("van-icon",{staticClass:"chat-icon",attrs:{name:"chat"},on:{click:t.showCommentBox}}),t._v(" "),n("comment-box",{attrs:{show:t.show},on:{closed:t.closeCommentBox}})],1)},Kt=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"waves"},[n("div",{staticClass:"wave wave_1"}),t._v(" "),n("div",{staticClass:"wave wave_2"}),t._v(" "),n("div",{staticClass:"wave wave_3"}),t._v(" "),n("div",{staticClass:"wave wave_4"}),t._v(" "),n("div",{staticClass:"wave wave_5"})])}],Gt={render:Jt,staticRenderFns:Kt},Wt=Gt,Yt=n("VU/8"),Qt=l,Zt=Yt(Ht,Wt,!1,Qt,null,null),te=Zt.exports,ee={name:"Board",components:{Rank:Vt,Comment:te},data:function(){return{}},methods:{},mounted:function(){var t=localStorage.getItem("email"),e=localStorage.getItem("room_id");t?e||this.$router.push({name:"Code"}):this.$router.push({name:"Register"}),ft()}},ne=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"board"},[n("van-tabs",[n("van-tab",{attrs:{title:"游戏规则"}},[n("div",{staticClass:"rules-wrapper"},[n("p",[t._v("开心 666 是一场实时直播答题活动。")]),t._v(" "),n("p",[t._v("答题结束后分数前三名可以分得本场奖金。")]),t._v(" "),n("p",[t._v("每场活动 10 题，每题 3 个选项。从中选择你认为正确的唯一选项。")]),t._v(" "),n("p",[t._v("每题答题时间只有 10 秒。答题越快分数越高。")]),t._v(" "),n("p",[t._v("奖项设置：")]),t._v(" "),n("p",[t._v("第一名：300 元")]),t._v(" "),n("p",[t._v("第二名：200 元")]),t._v(" "),n("p",[t._v("第三名：100 元")]),t._v(" "),n("p",[t._v("第四名到第十名，主持人会现场组建小群发 66 元红包。")])])]),t._v(" "),n("van-tab",{attrs:{title:"实时排行榜"}},[n("rank")],1)],1),t._v(" "),n("comment")],1)},se=[],oe={render:ne,staticRenderFns:se},ae=oe,ie=n("VU/8"),re=u,ce=ie(ee,ae,!1,re,null,null),le=ce.exports,ue={name:"Code",data:function(){return{code:"",showKeyboard:!0,error:""}},methods:{onInput:function(t){this.code=(this.code+t).slice(0,4),4===this.code.length&&this.submit(this.code)},onDelete:function(){this.code=this.code.slice(0,this.code.length-1)},submit:function(t){var e=this,n=localStorage.getItem("email");D.join(n,t).then(function(t){localStorage.setItem("room_id",t.room_id),localStorage.setItem("exam_id",t.exam.exam_id),e.$router.push({name:"Board"})},function(){e.code="",e.error="邀请码错误"})}}},de=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"code"},[n("van-password-input",{attrs:{value:t.code,length:4,info:"请输入 4 位邀请码","error-info":t.error},on:{focus:function(e){t.showKeyboard=!0}}}),t._v(" "),n("van-number-keyboard",{attrs:{show:t.showKeyboard},on:{input:t.onInput,delete:t.onDelete,blur:function(e){t.showKeyboard=!1}}})],1)},me=[],he={render:de,staticRenderFns:me},fe=he,ve=n("VU/8"),pe=d,_e=ve(ue,fe,!1,pe,null,null),ge=_e.exports;m.default.use(H.a);var be=new H.a({routes:[{path:"/",name:"Index",component:et},{path:"/register",name:"Register",component:ut},{path:"/board",name:"Board",component:le},{path:"/code",name:"Code",component:ge}]});n("hKoQ").polyfill(),m.default.config.productionTip=!1,m.default.use(f.a),new m.default({el:"#app",router:be,components:{App:X},template:"<App/>"})},Nj8z:function(t,e){},XVgI:function(t,e){},i6jY:function(t,e){},ubtR:function(t,e){},uko2:function(t,e){}},["NHnr"]);